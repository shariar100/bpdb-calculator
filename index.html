<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="LT-A Electricity Cost Calculator">BPDB LT-A Electricity Cost Calculator with History</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ...[CSS unchanged, keep all your original CSS here]... */
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a4d69);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        header {
            background: #0a3d62;
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .logo {
            position: absolute;
            top: 20px;
            left: 25px;
            font-size: 28px;
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tariff-info {
            background: #e1f5fe;
            padding: 15px;
            font-size: 1rem;
            text-align: center;
            border-bottom: 2px dashed #4fc3f7;
            font-weight: 500;
        }
        .calculator {
            padding: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        @media (max-width: 768px) {
            .calculator { grid-template-columns: 1fr; }
        }
        .input-section, .result-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .helper-text {
            color: #888;
            font-size: 0.96em;
            margin-top: 3px;
        }
        .input-warning {
            margin-top: 3px;
        }
        .input-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0a3d62;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        input:focus {
            border-color: #4fc3f7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79,195,247,0.3);
        }
        .charge-group { margin: 25px 0; }
        .charge-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #eaeaea;
        }
        .charge-item:last-child { border-bottom: none; }
        .charge-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .charge-value {
            width: 100px;
            padding: 10px;
            text-align: right;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-weight: 600;
        }
        .charge-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        .charge-label i { color: #0a3d62; font-size: 18px; }
        .toggle-group { display: flex; align-items: center; gap: 10px; }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: #2196F3; }
        input:checked + .toggle-slider:before { transform: translateX(26px); }
        button {
            background: linear-gradient(to right, #0a3d62, #1a5276);
            color: white;
            border: none;
            padding: 16px;
            width: 100%;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        button:hover {
            background: linear-gradient(to right, #1a5276, #2471a3);
        }
        .btn-secondary {
            background: linear-gradient(to right, #6c757d, #5a6268);
        }
        .btn-secondary:hover {
            background: linear-gradient(to right, #5a6268, #495057);
        }
        .btn-success {
            background: linear-gradient(to right, #28a745, #218838);
        }
        .btn-success:hover {
            background: linear-gradient(to right, #218838, #1e7e34);
        }
        .btn-danger {
            background: linear-gradient(to right, #dc3545, #c82333);
        }
        .btn-danger:hover {
            background: linear-gradient(to right, #c82333, #bd2130);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-group button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
        }
        .results {
            background: #e8f4fc;
            border-radius: 10px;
            padding: 20px;
            display: none;
            border-left: 5px solid #0a3d62;
        }
        .results.active { display: block; }
        .results h2 {
            color: #0a3d62;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #b3e5fc;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px dashed #b3e5fc;
        }
        .result-item:last-child { border-bottom: none; }
        .result-label { font-weight: 600; color: #0a3d62; }
        .value { font-weight: bold; color: #e74c3c; font-size: 18px; }
        .breakdown {
            margin-top: 25px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .breakdown h3 {
            color: #0a3d62;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            color: #555;
        }
        .breakdown-value { font-weight: 600; }
        .slab-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        .slab-table th {
            background: #0a3d62;
            color: white;
            padding: 14px;
            text-align: left;
            font-weight: 600;
        }
        .slab-table td {
            padding: 14px;
            border-bottom: 1px solid #eee;
        }
        .slab-table tr:nth-child(even) { background-color: #f5f9ff; }
        .slab-table tr:hover { background-color: #e1f5fe; }
        .slab-table .slab-rate { font-weight: 700; color: #0a3d62; }
        .highlight { background: #fff8e1 !important; font-weight: 700; }
        .disclaimer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .disclaimer i { color: #ffc107; margin-right: 10px; font-size: 20px; }
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 25px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 30px;
            display: flex;
            gap: 10px;
            cursor: pointer;
        }
        .language-toggle span {
            padding: 5px 10px;
            border-radius: 20px;
        }
        .language-toggle span.active {
            background: white;
            color: #0a3d62;
            font-weight: 600;
        }
        .social-sharing {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .social-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        .social-btn.facebook { background: #3b5998; }
        .social-btn.twitter { background: #1da1f2; }
        .social-btn.whatsapp { background: #25d366; }
        .social-btn.email { background: #d44638; }
        .edit-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .edit-controls button { margin-top: 0; }
        .slab-edit-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .slab-edit-row input { flex: 1; padding: 10px; }
        .remove-slab {
            background: #dc3545;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .add-slab-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        .add-slab-btn:hover { background: #218838; }
        .slab-editor {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .slab-editor.active { display: block; }
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.95rem;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        .history-section {
            margin-top: 25px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .history-section h3 {
            color: #0a3d62;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .history-list {
            list-style-type: none;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        .history-list li {
            padding: 10px 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-list li:last-child { border-bottom: none; }
        .history-units { font-weight: 600; color: #0a3d62; }
        .history-cost { font-weight: 700; color: #e74c3c; }
        .history-date { font-size: 0.8rem; color: #7f8c8d; margin-top: 3px; }
        .history-empty { text-align: center; color: #7f8c8d; padding: 15px; font-style: italic; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .clear-history-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .clear-history-btn:hover { background: #c82333; }
        @media (max-width: 600px) {
          .container {
            max-width: 100vw;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
          }
          .calculator {
            grid-template-columns: 1fr;
            gap: 10px;
            padding: 0;
          }
          .input-section, .result-section, .slab-editor {
            padding: 12px 5px;
            border-radius: auto;
            min-width: 0;
          }
          .results h2, .breakdown h3, .history-section h3 {
            font-size: 1.1rem;
            padding-bottom: 7px;
          }
          button {
            font-size: 16px;
            padding: 12px;
          }
          input, select, .charge-value {
            font-size: 15px;
            padding: 10px;
          }
          .charge-label { font-size: 14px; }
          .result-label, .value { font-size: 15px; }
        }
        @media (max-width: 400px) {
          .slab-table, .slab-table th, .slab-table td {
            font-size: 12px;
            padding: 4px;
          }
          .results h2, .breakdown h3, .history-section h3 {
            font-size: 1rem;
          }
        }
        .slab-table {
          display: block;
          overflow-x: auto;
          min-width: 320px;
        }
        @keyframes pulse {
          0% { transform: scale(1); filter: brightness(1);}
          50% { transform: scale(1.25); filter: brightness(1.4);}
          100% { transform: scale(1); filter: brightness(1);}
        }
        .pulse { animation: pulse 1s infinite; }
        .bpdb-link-group {
          display: flex;
          gap: 18px;
          justify-content: center;
          margin: 18px 0 0 0;
          flex-wrap: wrap;
        }
        .bpdb-link {
          color: #1976d2;
          font-weight: bold;
          text-decoration: underline;
          transition: color 0.2s, background 0.2s;
          padding: 6px 14px;
          border-radius: 20px;
          background: #e3f2fd;
          border: 1px solid #bbdefb;
          margin: 4px 0;
        }
        .bpdb-link:hover, .bpdb-link:focus {
          color: #fff;
          background: #1976d2;
          text-decoration: none;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">
            <i class="fas fa-bolt pulse"></i>
            <span>BPDB</span>
        </div>
        <div class="language-toggle" id="languageToggle" aria-label="Change language" role="group">
            <span class="active" data-lang="en" tabindex="0">EN</span>
            <span data-lang="bn" tabindex="0">BN</span>
        </div>
        <h1 data-translate="LT-A Electricity Cost Calculator">
            <i class="fas fa-calculator"></i>
            LT-A Electricity Cost Calculator
        </h1>
        <p data-translate="Official Tariff as of February 2024">Official Tariff as of February 2024</p>
    </header>
    <div class="tariff-info" data-translate="Calculate your electricity bill with customizable charges">
        <i class="fas fa-info-circle"></i>
        Calculate your electricity bill with customizable charges
    </div>
    <div class="calculator">
        <div class="input-section">
            <div class="input-group">
                <label for="units" id="units-label" data-translate="Enter total units consumed (kWh):">
                    <i class="fas fa-bolt"></i>
                    Enter total units consumed (kWh):
                </label>
                <input type="number" id="units" min="0" step="0.01" placeholder="e.g., 150" aria-labelledby="units-label" value="150">
                <div class="helper-text" data-translate="Check your electricity bill or prepaid meter display for total units used.">Check your electricity bill or prepaid meter display for total units used.</div>
                <div class="input-warning" id="units-warning" style="display:none;color:#e74c3c;font-size:0.95em;"></div>
            </div>
            <div class="input-group">
                <label for="days" id="days-label" data-translate="Enter number of days in billing period:">
                    <i class="fas fa-calendar-alt"></i>
                    Enter number of days in billing period:
                </label>
                <input type="number" id="days" min="1" value="30" placeholder="e.g., 30" aria-labelledby="days-label">
                <div class="helper-text" data-translate="Most bills use 28–31 days. Check your bill period for accuracy.">Most bills use 28–31 days. Check your bill period for accuracy.</div>
                <div class="input-warning" id="days-warning" style="display:none;color:#e74c3c;font-size:0.95em;"></div>
            </div>
            <div class="charge-group">
                <h3 style="color: #0a3d62; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;"
                    data-translate="Customize Additional Charges">
                    <i class="fas fa-cog"></i>
                    Customize Additional Charges
                </h3>
                <div class="charge-item">
                    <div class="toggle-group">
                        <label class="toggle-switch" for="includeVAT">
                            <input type="checkbox" id="includeVAT" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="charge-label" data-translate="VAT (%)">
                            <i class="fas fa-percentage"></i>
                            VAT (%)
                        </div>
                    </div>
                    <div class="charge-control">
                        <input type="number" id="vatValue" class="charge-value" value="5" min="0" max="100" step="0.1">
                        <span>%</span>
                    </div>
                </div>
                <div class="charge-item">
                    <div class="toggle-group">
                        <label class="toggle-switch" for="includeRebate">
                            <input type="checkbox" id="includeRebate">
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="charge-label" data-translate="Rebate (%)">
                            <i class="fas fa-tag"></i>
                            Rebate (%)
                        </div>
                    </div>
                    <div class="charge-control">
                        <input type="number" id="rebateValue" class="charge-value" value="0.5" min="0" max="100" step="0.1">
                        <span>%</span>
                    </div>
                </div>
                <div class="charge-item">
                    <div class="toggle-group">
                        <label class="toggle-switch" for="includeMeterRent">
                            <input type="checkbox" id="includeMeterRent" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="charge-label" data-translate="Meter Rent (Tk)">
                            <i class="fas fa-home"></i>
                            Meter Rent (Tk)
                        </div>
                    </div>
                    <div class="charge-control">
                        <input type="number" id="meterRentValue" class="charge-value" value="40" min="0" step="1">
                        <span>Tk</span>
                    </div>
                </div>
                <div class="charge-item">
                    <div class="toggle-group">
                        <label class="toggle-switch" for="includeDemandCharge">
                            <input type="checkbox" id="includeDemandCharge" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="charge-label" data-translate="Demand Charge (Tk)">
                            <i class="fas fa-plug"></i>
                            Demand Charge (Tk)
                        </div>
                    </div>
                    <div class="charge-control">
                        <input type="number" id="demandChargeValue" class="charge-value" value="84" min="0" step="1">
                        <span>Tk</span>
                    </div>
                </div>
            </div>
            <button onclick="calculateCost()" data-translate="Calculate Electricity Cost">
                <i class="fas fa-calculator"></i>
                Calculate Electricity Cost
            </button>
<div class="disclaimer">
    <i class="fas fa-exclamation-triangle"></i>
    <strong data-translate="Note:">Note:</strong>
    <span data-translate="This calculator is designed for BPDB Residential Prepaid Meter consumers only. Rates are based on the official February 2024 tariff structure.">
        This calculator is designed for BPDB Residential Prepaid Meter consumers only. Rates are based on the official February 2024 tariff structure.
    </span>
</div>
        </div>
        <div class="result-section">
            <div class="results" id="results">
                <h2 data-translate="Bill Calculation Results">
                    <i class="fas fa-file-invoice-dollar"></i>
                    Bill Calculation Results
                </h2>
                <div class="result-item">
                    <span class="result-label" data-translate="Total Cost:">Total Cost:</span>
                    <span class="value" id="totalCost">Tk 0.00</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-translate="Average Cost per Unit:">Average Cost per Unit:</span>
                    <span class="value" id="avgPerUnit">Tk 0.00</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-translate="Daily Consumption:">Daily Consumption:</span>
                    <span class="value" id="kwhPerDay">0.00 kWh</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-translate="Daily Cost:">Daily Cost:</span>
                    <span class="value" id="costPerDay">Tk 0.00</span>
                </div>
                <div class="breakdown">
                    <h3 data-translate="Cost Breakdown">
                        <i class="fas fa-receipt"></i>
                        Cost Breakdown
                    </h3>
                    <div class="breakdown-item">
                        <span data-translate="Energy Cost:">Energy Cost:</span>
                        <span class="breakdown-value" id="energyCost">Tk 0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span>VAT (<span id="vatPercent">5</span>%):</span>
                        <span class="breakdown-value" id="vatAmount">Tk 0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Rebate (<span id="rebatePercent">0.5</span>%):</span>
                        <span class="breakdown-value" id="rebateAmount">Tk -0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span data-translate="Meter Rent:">Meter Rent:</span>
                        <span class="breakdown-value" id="meterRentAmount">Tk 0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span data-translate="Demand Charge:">Demand Charge:</span>
                        <span class="breakdown-value" id="demandChargeAmount">Tk 0.00</span>
                    </div>
                </div>
                <div class="history-section">
                    <div class="history-header">
                        <h3 data-translate="Recent Calculations">
                            <i class="fas fa-history"></i>
                            Recent Calculations
                        </h3>
                        <button class="clear-history-btn" onclick="clearHistory()" data-translate="Clear History">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                    </div>
                    <ul class="history-list" id="historyList" aria-live="polite">
                        <li class="history-empty" data-translate="No calculation history yet">No calculation history yet</li>
                    </ul>
                </div>
                <div class="btn-group">
                    <button class="btn-secondary" onclick="downloadPDF()" data-translate="PDF">
                        <i class="fas fa-download"></i> PDF
                    </button>
                    <button class="btn-secondary" onclick="downloadImage()" data-translate="Image">
                        <i class="fas fa-image"></i> Image
                    </button>
                    <button class="btn-secondary" onclick="window.print()" data-translate="Print">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
                <div class="social-sharing">
                    <div class="social-btn facebook" onclick="shareOnFacebook()" tabindex="0">
                        <i class="fab fa-facebook-f"></i>
                    </div>
                    <div class="social-btn twitter" onclick="shareOnTwitter()" tabindex="0">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="social-btn whatsapp" onclick="shareOnWhatsApp()" tabindex="0">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="social-btn email" onclick="shareViaEmail()" tabindex="0">
                        <i class="fas fa-envelope"></i>
                    </div>
                </div>
            </div>
            <div class="edit-controls">
                <button class="btn-success" id="toggleSlabEditor" data-translate="Edit Slabs">
                    <i class="fas fa-edit"></i> Edit Slabs
                </button>
                <button class="btn-danger" onclick="resetSlabs()" data-translate="Reset">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>
            <div class="slab-editor" id="slabEditor">
                <h3 style="color: #0a3d62; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;" data-translate="Edit Tariff Slabs">
                    <i class="fas fa-edit"></i>
                    Edit Tariff Slabs
                </h3>
                <div id="slabEditContainer">
                    <!-- Slabs will be added here dynamically -->
                </div>
                <button class="add-slab-btn" onclick="addSlabRow()" data-translate="Add Slab">
                    <i class="fas fa-plus"></i> Add Slab
                </button>
                <div class="slab-update-reminder" style="margin-top:18px; background:#fff3cd; border-left:4px solid #ffc107; padding:12px; border-radius:6px;">
                    <i class="fas fa-exclamation-circle" style="color:#ffc107;"></i>
                    <strong data-translate="Manual update reminder:">Manual update reminder:</strong>
                    <span data-translate="Please verify slab rates regularly.">Please verify slab rates regularly.</span>
                    <br>
                    <a href="https://bpdb.gov.bd/site/page/c413c44f-9611-4320-82da-b298fe69157e/%E0%A6%9F%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%B0%E0%A6%BF%E0%A6%AB-%E0%A6%B0%E0%A7%87%E0%A6%9F"
                       target="_blank"
                       rel="noopener"
                       style="color:#0a3d62; font-weight:bold; text-decoration:underline;"
                       data-translate="Check for official updates here">
                       Check for official updates here
                    </a>
                </div>
            </div>
            <table class="slab-table" id="slabTable">
                <thead>
                    <tr>
                        <th scope="col" data-translate="Step">Step</th>
                        <th scope="col" data-translate="Consumption Range (kWh)">Consumption Range (kWh)</th>
                        <th scope="col" data-translate="Rate (Tk/kWh)">Rate (Tk/kWh)</th>
                    </tr>
                </thead>
                <tbody id="slabTableBody">
                    <!-- Slabs will be added here dynamically -->
                </tbody>
            </table>
            <div class="bpdb-link-group">
                <a id="bpdbTokenLink" class="bpdb-link" href="https://web.bpdbprepaid.gov.bd/bn/token-check" target="_blank" rel="noopener" data-translate="BPDB Last 3 Tokens">
                    BPDB Last 3 Tokens
                </a>
                <a id="bpdbShortCodeLink" class="bpdb-link" href="https://web.bpdbprepaid.gov.bd/bn/meter-short-codes" target="_blank" rel="noopener" data-translate="BPDB Meter Short Code">
                    BPDB Meter Short Code
                </a>
                <a id="bpdbEnergyCalcLink" class="bpdb-link" href="https://web.bpdbprepaid.gov.bd/bn/bill-calculator" target="_blank" rel="noopener" data-translate="Prepaid Meter Energy Charge Calculator">
                    Prepaid Meter Energy Charge Calculator
                </a>
            </div>
        </div>
    </div>
<footer id="footer">
    <i class="fas fa-exclamation-circle"></i>
    © <span id="footerYear"></span> BPDB LT-A Electricity Calculator
</footer>
</div>
<script>
/* ----------- Improved Translations ----------- */
const translations = {
    en: {
        "LT-A Electricity Cost Calculator": "LT-A Electricity Cost Calculator",
        "BPDB Last 3 Tokens": "BPDB Last 3 Tokens",
        "BPDB Meter Short Code": "BPDB Meter Short Code",
        "Prepaid Meter Energy Charge Calculator": "Prepaid Meter Energy Charge Calculator",
        "Official Tariff as of February 2024": "Official Tariff as of February 2024",
        "Calculate your electricity bill with customizable charges": "Calculate your electricity bill with customizable charges",
        "Enter total units consumed (kWh):": "Enter total units consumed (kWh):",
        "Enter number of days in billing period:": "Enter number of days in billing period:",
        "Customize Additional Charges": "Customize Additional Charges",
        "VAT (%)": "VAT (%)",
        "Rebate (%)": "Rebate (%)",
        "Meter Rent (Tk)": "Meter Rent (Tk)",
        "Demand Charge (Tk)": "Demand Charge (Tk)",
        "Calculate Electricity Cost": "Calculate Electricity Cost",
        "Note:": "Note:",
        "This calculator is designed for BPDB Residential Prepaid Meter consumers only. Rates are based on the official February 2024 tariff structure.": "This calculator is designed for BPDB Residential Prepaid Meter consumers only. Rates are based on the official February 2024 tariff structure.",
        "Bill Calculation Results": "Bill Calculation Results",
        "Total Cost:": "Total Cost:",
        "Average Cost per Unit:": "Average Cost per Unit:",
        "Daily Consumption:": "Daily Consumption:",
        "Daily Cost:": "Daily Cost:",
        "Cost Breakdown": "Cost Breakdown",
        "Energy Cost:": "Energy Cost:",
        "VAT": "VAT",
        "Rebate": "Rebate",
        "Meter Rent:": "Meter Rent:",
        "Demand Charge:": "Demand Charge:",
        "Recent Calculations": "Recent Calculations",
        "Clear History": "Clear History",
        "No calculation history yet": "No calculation history yet",
        "PDF": "PDF",
        "Image": "Image",
        "Print": "Print",
        "Edit Slabs": "Edit Slabs",
        "Reset": "Reset",
        "Edit Tariff Slabs": "Edit Tariff Slabs",
        "Add Slab": "Add Slab",
        "Step": "Step",
        "Consumption Range (kWh)": "Consumption Range (kWh)",
        "Rate (Tk/kWh)": "Rate (Tk/kWh)",
        "Manual update reminder:": "Manual update reminder:",
        "Please verify slab rates regularly.": "Please verify slab rates regularly.",
        "Check for official updates here": "Check for official updates here",
        "For official use only": "For official use only",
        "Not applied": "Not applied",
        "Please enter valid units (numbers only)!": "Please enter valid units (numbers only)!",
        "Please enter a valid number of days (minimum 1 day)!": "Please enter a valid number of days (minimum 1 day)!",
        "You must have at least one slab!": "You must have at least one slab!",
        "Reset to default slabs?": "Reset to default slabs?",
        "Clear all calculation history?": "Clear all calculation history?",
        "Check your electricity bill or prepaid meter display for total units used.": "Check your electricity bill or prepaid meter display for total units used.",
        "Most bills use 28–31 days. Check your bill period for accuracy.": "Most bills use 28–31 days. Check your bill period for accuracy."
    },
    bn: {
        "LT-A Electricity Cost Calculator": "এলটি-এ বিদ্যুৎ বিল ক্যালকুলেটর",
        "BPDB Last 3 Tokens": "সর্বশেষ ৩টি টোকেন",
        "BPDB Meter Short Code": "মিটার শর্ট কোড",
        "Prepaid Meter Energy Charge Calculator": "প্রিপেইড মিটার বিল ক্যালকুলেটর",
        "Official Tariff as of February 2024": "ফেব্রুয়ারি ২০২৪ অনুযায়ী অফিসিয়াল ট্যারিফ",
        "Calculate your electricity bill with customizable charges": "কাস্টমাইজযোগ্য চার্জসহ আপনার বিদ্যুৎ বিল হিসাব করুন",
        "Enter total units consumed (kWh):": "মোট ব্যবহৃত ইউনিট (কিঃওঃঘঃ):",
        "Enter number of days in billing period:": "বিল সময়কালের দিন সংখ্যা:",
        "Customize Additional Charges": "অতিরিক্ত চার্জ কাস্টমাইজ",
        "VAT (%)": "ভ্যাট (%)",
        "Rebate (%)": "রিবেট (%)",
        "Meter Rent (Tk)": "মিটার ভাড়া (টাকা)",
        "Demand Charge (Tk)": "ডিমান্ড চার্জ (টাকা)",
        "Calculate Electricity Cost": "বিদ্যুৎ বিল হিসাব করুন",
        "Note:": "বিঃদ্রঃ",
        "This calculator is designed for BPDB Residential Prepaid Meter consumers only. Rates are based on the official February 2024 tariff structure.": "এই ক্যালকুলেটরটি শুধুমাত্র বিপিডিবি আবাসিক প্রিপেইড মিটার গ্রাহকদের জন্য। ফেব্রুয়ারি ২০২৪ অনুযায়ী অফিসিয়াল ট্যারিফ।",
        "Bill Calculation Results": "বিল হিসাবের ফলাফল",
        "Total Cost:": "মোট খরচ:",
        "Average Cost per Unit:": "প্রতি ইউনিটে গড় খরচ:",
        "Daily Consumption:": "দৈনিক ব্যবহার:",
        "Daily Cost:": "দৈনিক খরচ:",
        "Cost Breakdown": "খরচের বিশদ বিবরণ",
        "Energy Cost:": "এনার্জি চার্জ:",
        "VAT": "ভ্যাট",
        "Rebate": "রিবেট",
        "Meter Rent:": "মিটার ভাড়া:",
        "Demand Charge:": "ডিমান্ড চার্জ:",
        "Recent Calculations": "সাম্প্রতিক হিসাব",
        "Clear History": "হিসাব মুছুন",
        "No calculation history yet": "এখনও কোন হিসাব নেই",
        "PDF": "পিডিএফ",
        "Image": "ছবি",
        "Print": "প্রিন্ট",
        "Edit Slabs": "স্ল্যাব সম্পাদনা",
        "Reset": "রিসেট",
        "Edit Tariff Slabs": "ট্যারিফ স্ল্যাব সম্পাদনা",
        "Add Slab": "নতুন স্ল্যাব",
        "Step": "ধাপ",
        "Consumption Range (kWh)": "ব্যবহারের পরিসীমা (কিঃওঃঘঃ)",
        "Rate (Tk/kWh)": "দর (টাকা/কিঃওঃঘঃ)",
        "Manual update reminder:": "ম্যানুয়াল আপডেট স্মরণিকা:",
        "Please verify slab rates regularly.": "অনুগ্রহ করে নিয়মিত স্ল্যাব রেট যাচাই করুন।",
        "Check for official updates here": "অফিসিয়াল আপডেট এখানে দেখুন",
        "For official use only": "শুধুমাত্র অফিসিয়াল ব্যবহারের জন্য",
        "Not applied": "প্রযোজ্য নয়",
        "Please enter valid units (numbers only)!": "অনুগ্রহ করে সঠিক ইউনিট লিখুন (শুধু সংখ্যা)!",
        "Please enter a valid number of days (minimum 1 day)!": "অনুগ্রহ করে সঠিক দিন সংখ্যা লিখুন (ন্যূনতম ১ দিন)!",
        "You must have at least one slab!": "কমপক্ষে একটি স্ল্যাব থাকতে হবে!",
        "Reset to default slabs?": "ডিফল্ট স্ল্যাবে ফিরে যাবেন?",
        "Clear all calculation history?": "সমস্ত হিসাবের ইতিহাস মুছে ফেলবেন?",
        "Check your electricity bill or prepaid meter display for total units used.": "আপনার বিদ্যুৎ বিল বা প্রিপেইড মিটারের ডিসপ্লেতে মোট ব্যবহৃত ইউনিট দেখুন।",
        "Most bills use 28–31 days. Check your bill period for accuracy.": "বেশিরভাগ বিলের সময়কাল ২৮–৩১ দিন। সঠিকতার জন্য বিল দেখুন।"
    }
};

// Set language and update all elements with data-translate
function setLanguage(lang) {
    if (!['en', 'bn'].includes(lang)) {
        console.error('Invalid language code:', lang);
        return;
    }
    // Toggle active class on language toggle
    document.querySelectorAll('[data-lang]').forEach(el => {
        el.classList.toggle('active', el.getAttribute('data-lang') === lang);
    });

    localStorage.setItem('preferred_language', lang);
    document.documentElement.lang = lang;
    const t = translations[lang];

    // Update all elements with data-translate
    document.querySelectorAll('[data-translate]').forEach(element => {
        let key = element.getAttribute('data-translate');
        if (t[key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                if (element.hasAttribute('placeholder')) {
                    element.placeholder = t[key];
                }
            } else {
                element.innerHTML = t[key];
            }
        }
    });

    // Special for some elements with innerHTML and variables (breakdown VAT/Rebate)
    document.querySelectorAll('.breakdown-item')[1].querySelector('span').innerHTML = t["VAT"] + ' (<span id="vatPercent">' + document.getElementById('vatPercent').textContent + '</span>%):';
    document.querySelectorAll('.breakdown-item')[2].querySelector('span').innerHTML = t["Rebate"] + ' (<span id="rebatePercent">' + document.getElementById('rebatePercent').textContent + '</span>%):';

    // Table headers
    const ths = document.querySelectorAll('.slab-table th');
    if (ths.length >= 3) {
        ths[0].textContent = t["Step"];
        ths[1].textContent = t["Consumption Range (kWh)"];
        ths[2].textContent = t["Rate (Tk/kWh)"];
    }

    // Footer
    document.getElementById("footerYear").textContent = new Date().getFullYear();

    // BPDB Links
    document.getElementById("bpdbTokenLink").textContent = t["BPDB Last 3 Tokens"];
    document.getElementById("bpdbShortCodeLink").textContent = t["BPDB Meter Short Code"];
    document.getElementById("bpdbEnergyCalcLink").textContent = t["Prepaid Meter Energy Charge Calculator"];
}

// Language toggle events
document.addEventListener('DOMContentLoaded', () => {
    const storedLang = localStorage.getItem('preferred_language') || 'en';
    setLanguage(storedLang);
    document.getElementById('languageToggle').addEventListener('click', (e) => {
        if (e.target.dataset.lang) setLanguage(e.target.dataset.lang);
    });
    document.querySelectorAll('.language-toggle span').forEach(span => {
        span.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && span.dataset.lang) setLanguage(span.dataset.lang);
        });
    });
});

/* ----------- [Original Calculator JavaScript Code] ----------- */
/* ...[Paste your original JavaScript logic for slabs, history, PDF, etc. below this comment. No translation logic here, keep as in your original code]... */
let slabs = [
    { min: 0, max: 50, rate: 4.63 },
    { min: 51, max: 75, rate: 5.26 },
    { min: 76, max: 200, rate: 7.20 },
    { min: 201, max: 300, rate: 7.59 },
    { min: 301, max: 400, rate: 8.02 },
    { min: 401, max: 600, rate: 12.67 },
    { min: 601, max: Infinity, rate: 14.61 }
];
// LocalStorage
function saveSettings() { try { localStorage.setItem('bpdb_slabs', JSON.stringify(slabs)); } catch (e) {} }
function loadSettings() { try { const slabData = localStorage.getItem('bpdb_slabs'); if (slabData) slabs = JSON.parse(slabData); } catch (e) {} }
function saveHistory(history) { try { localStorage.setItem('bpdb_history', JSON.stringify(history)); } catch (e) {} }
function loadHistory() { try { return JSON.parse(localStorage.getItem('bpdb_history') || '[]'); } catch (e) { return []; } }
// Slab Table Rendering
function renderSlabTable() {
    const tbody = document.getElementById('slabTableBody');
    tbody.innerHTML = '';
    slabs.forEach((slab, idx) => {
        const maxShow = slab.max === Infinity ? '∞' : slab.max;
        tbody.innerHTML += `<tr>
            <td>${idx + 1}</td>
            <td>${slab.min} - ${maxShow}</td>
            <td class="slab-rate">${slab.rate.toFixed(2)}</td>
        </tr>`;
    });
}
function renderSlabEditor() {
    const container = document.getElementById('slabEditContainer');
    container.innerHTML = '';
    slabs.forEach((slab, idx) => {
        container.innerHTML += `
            <div class="slab-edit-row">
                <input type="number" min="0" value="${slab.min}" onchange="updateSlab(${idx}, 'min', this.value)">
                <input type="number" min="0" value="${slab.max === Infinity ? '' : slab.max}" placeholder="Max" onchange="updateSlab(${idx}, 'max', this.value)">
                <input type="number" min="0" step="0.01" value="${slab.rate}" onchange="updateSlab(${idx}, 'rate', this.value)">
                <button class="remove-slab" onclick="removeSlab(${idx})"><i class="fas fa-trash"></i></button>
            </div>
        `;
    });
}
function updateSlab(idx, field, value) {
    if (field === 'min') slabs[idx].min = parseInt(value) || 0;
    if (field === 'max') slabs[idx].max = value === '' ? Infinity : parseInt(value);
    if (field === 'rate') slabs[idx].rate = parseFloat(value) || 0;
    saveSettings();
    renderSlabTable();
    renderSlabEditor();
}
function removeSlab(idx) {
    if (slabs.length === 1) { alert(translations[getCurrentLang()]["You must have at least one slab!"]); return; }
    slabs.splice(idx, 1);
    saveSettings();
    renderSlabTable();
    renderSlabEditor();
}
function addSlabRow() {
    let last = slabs[slabs.length - 1];
    slabs.push({ min: (last.max === Infinity ? last.min + 1 : last.max + 1), max: Infinity, rate: last.rate });
    if (last.max === Infinity) last.max = last.min + 99;
    saveSettings();
    renderSlabTable();
    renderSlabEditor();
}
function resetSlabs() {
    if (!confirm(translations[getCurrentLang()]["Reset to default slabs?"])) return;
    slabs = [
        { min: 0, max: 50, rate: 4.63 },
        { min: 51, max: 75, rate: 5.26 },
        { min: 76, max: 200, rate: 7.20 },
        { min: 201, max: 300, rate: 7.59 },
        { min: 301, max: 400, rate: 8.02 },
        { min: 401, max: 600, rate: 12.67 },
        { min: 601, max: Infinity, rate: 14.61 }
    ];
    saveSettings();
    renderSlabTable();
    renderSlabEditor();
}
function calculateCost() {
    checkInputsForWarnings();
    const units = parseFloat(document.getElementById('units').value);
    const days = parseInt(document.getElementById('days').value);
    if (isNaN(units) || units < 0) { alert(translations[getCurrentLang()]["Please enter valid units (numbers only)!"]); return; }
    if (isNaN(days) || days < 1) { alert(translations[getCurrentLang()]["Please enter a valid number of days (minimum 1 day)!"]); return; }
    let remaining = units, energyCost = 0;
    for (let slab of slabs) {
        let slabMax = slab.max === Infinity ? units : slab.max;
        let slabMin = slab.min;
        let slabUnits = Math.max(0, Math.min(remaining, slabMax - slabMin + 1));
        if (slabUnits > 0) {
            let cost = slabUnits * slab.rate;
            energyCost += cost;
            remaining -= slabUnits;
        }
        if (remaining <= 0) break;
    }
    let vatChecked = document.getElementById('includeVAT').checked;
    let rebateChecked = document.getElementById('includeRebate').checked;
    let meterRentChecked = document.getElementById('includeMeterRent').checked;
    let demandChargeChecked = document.getElementById('includeDemandCharge').checked;
    let vatValue = parseFloat(document.getElementById('vatValue').value) || 0;
    let rebateValue = parseFloat(document.getElementById('rebateValue').value) || 0;
    let meterRent = meterRentChecked ? (parseFloat(document.getElementById('meterRentValue').value) || 0) : 0;
    let demandCharge = demandChargeChecked ? (parseFloat(document.getElementById('demandChargeValue').value) || 0) : 0;
    let vat = vatChecked ? energyCost * vatValue / 100 : 0;
    let rebate = rebateChecked ? energyCost * rebateValue / 100 : 0;
    let total = energyCost + vat - rebate + meterRent + demandCharge;
    let avgPerUnit = total / units;
    let kwhPerDay = units / days;
    let costPerDay = total / days;
    document.getElementById('energyCost').textContent = 'Tk ' + energyCost.toFixed(2);
    document.getElementById('vatAmount').textContent = 'Tk ' + vat.toFixed(2);
    document.getElementById('rebateAmount').textContent = 'Tk -' + rebate.toFixed(2);
    document.getElementById('meterRentAmount').textContent = 'Tk ' + meterRent.toFixed(2);
    document.getElementById('demandChargeAmount').textContent = 'Tk ' + demandCharge.toFixed(2);
    document.getElementById('totalCost').textContent = 'Tk ' + total.toFixed(2);
    document.getElementById('avgPerUnit').textContent = 'Tk ' + avgPerUnit.toFixed(2);
    document.getElementById('kwhPerDay').textContent = kwhPerDay.toFixed(2) + ' kWh';
    document.getElementById('costPerDay').textContent = 'Tk ' + costPerDay.toFixed(2);
    document.getElementById('results').classList.add('active');
    document.getElementById('vatPercent').textContent = vatValue;
    document.getElementById('rebatePercent').textContent = rebateValue;
    let history = loadHistory();
    history.unshift({
        units, days, total: total.toFixed(2),
        date: new Date().toLocaleString()
    });
    if (history.length > 20) history.pop();
    saveHistory(history);
    renderHistory();
}
function checkInputsForWarnings() {
    const units = parseFloat(document.getElementById('units').value);
    const unitsWarning = document.getElementById('units-warning');
    if (units > 5000) {
        unitsWarning.style.display = "block";
        unitsWarning.textContent = "Are you sure you used " + units + " units this month? That is unusually high for a residence.";
    } else {
        unitsWarning.style.display = "none";
        unitsWarning.textContent = "";
    }
    const days = parseInt(document.getElementById('days').value);
    const daysWarning = document.getElementById('days-warning');
    if (days > 31) {
        daysWarning.style.display = "block";
        daysWarning.textContent = "Billing period exceeds 31 days. Please check if this is correct.";
    } else {
        daysWarning.style.display = "none";
        daysWarning.textContent = "";
    }
}
document.getElementById('units').addEventListener('input', checkInputsForWarnings);
document.getElementById('days').addEventListener('input', checkInputsForWarnings);
// History
function renderHistory() {
    let history = loadHistory();
    let list = document.getElementById('historyList');
    if (!history.length) {
        list.innerHTML = '<li class="history-empty" data-translate="No calculation history yet">' + translations[getCurrentLang()]["No calculation history yet"] + '</li>';
        return;
    }
    list.innerHTML = '';
    history.forEach(item => {
        list.innerHTML += `<li>
            <span class="history-units">${item.units} kWh</span>
            <span class="history-cost">Tk ${item.total}</span>
            <span class="history-date">${item.date}</span>
        </li>`;
    });
}
function clearHistory() {
    if (!confirm(translations[getCurrentLang()]["Clear all calculation history?"])) return;
    saveHistory([]);
    renderHistory();
}
// PDF/Print
function downloadPDF() {
    const { jsPDF } = window.jspdf;
    html2canvas(document.querySelector('.results')).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF();
        pdf.addImage(imgData, 'PNG', 5, 5, 200, 0);
        pdf.save('bpdb_bill.pdf');
    });
}
function downloadImage() {
    const resultsDiv = document.getElementById('results');
    if (!resultsDiv.classList.contains('active')) {
        alert('Please calculate your bill first!');
        return;
    }
    html2canvas(resultsDiv).then(canvas => {
        const link = document.createElement('a');
        link.download = 'bpdb_bill.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
}
// Social Sharing
function shareOnFacebook() { window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href), '_blank'); }
function shareOnTwitter() { window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(location.href), '_blank'); }
function shareOnWhatsApp() { window.open('https://api.whatsapp.com/send?text=' + encodeURIComponent(location.href), '_blank'); }
function shareViaEmail() { window.location = `mailto:?subject=BPDB LT-A Electricity Bill Calculator&body=Try this tool: ${location.href}`; }
// Slab Editor Toggle
document.getElementById('toggleSlabEditor').onclick = function() {
    document.getElementById('slabEditor').classList.toggle('active');
};
// Helper to get current language
function getCurrentLang() {
    return localStorage.getItem('preferred_language') || 'en';
}
// On load
window.onload = function() {
    loadSettings();
    renderSlabTable();
    renderSlabEditor();
    renderHistory();
    document.getElementById('footerYear').textContent = new Date().getFullYear();
    setLanguage(getCurrentLang());
};
// Social btn keyboard support
document.querySelectorAll('.social-btn').forEach(btn => {
    btn.setAttribute('tabindex', '0');
    btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') btn.click();
    });
});
</script>
</body>
</html>